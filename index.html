<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Murder Mittens - Final Build</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; color: white; }
        #gui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        #dialogue-ui {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 800px; background: rgba(20,20,20,0.95);
            border-top: 4px solid #ff69b4; padding: 20px; display: none; pointer-events: auto;
        }
        .option-list button { display: block; width: 100%; text-align: left; background: #333; border: 1px solid #444; color: white; padding: 10px; margin: 5px 0; cursor: pointer; }
        .option-list button:hover { background: #ff69b4; }
        #interact-label { position: absolute; top: 60%; left: 50%; transform: translate(-50%,-50%); color: yellow; display: none; font-weight: bold; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>

    <div id="gui">
        <div id="interact-label">PRESS [E] TO INTERACT</div>
        <div id="dialogue-ui">
            <div id="npc-name" style="color: #ff69b4; font-weight: bold;">Fortune Teller</div>
            <div id="npc-text" style="margin: 15px 0;">...</div>
            <div class="option-list" id="npc-options"></div>
        </div>
    </div>

<script>
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a1a1a);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    scene.add(new THREE.AmbientLight(0xffffff, 2));

  // --- THE ONLY LOADER YOU NEED ---
let player = new THREE.Group(); 
scene.add(player);

// This pink box shows up if the cat model is still downloading
const loadingBox = new THREE.Mesh(
    new THREE.BoxGeometry(1, 1, 1), 
    new THREE.MeshBasicMaterial({ color: 0xff69b4 })
);
player.add(loadingBox);

const loader = new THREE.GLTFLoader();
loader.load('cat.glb', function(gltf) {
    player.remove(loadingBox); // Cat is here! Remove pink box.
    const catModel = gltf.scene;
    catModel.scale.set(1, 1, 1); 
    player.add(catModel);
    console.log("Cat model loaded!");
}, undefined, function(error) {
    console.error("Check your file name! Using pink box instead.");    });

    // --- LOBBY WORLD ---
    function box(w, h, d, x, y, z, hex) {
        const m = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshBasicMaterial({color: hex}));
        m.position.set(x,y,z); scene.add(m); return m;
    }
    box(50, 0.1, 50, 0, 0, 0, 0x333333); // Floor
    const tub = box(4, 1, 2, 10, 0.5, 5, 0xffffff); // Tub
    const teller = new THREE.Mesh(new THREE.SphereGeometry(0.7), new THREE.MeshBasicMaterial({color: 0x000000}));
    teller.position.set(10, 1.2, 5); scene.add(teller);
    const tv = box(2, 1.5, 0.2, -10, 1, 10, 0x000000); // TV

    // --- DIALOGUE DATA ---
    const dialogues = {
        'TELLER': { name: "Fortune Teller", root: { text: "Hi, I'm the fortune teller...", opts: [{t: "Why the tub?", n: "why"}] }, why: { text: "Even animatronics need a bath.", opts: [{t: "Back", n: "root"}] } },
        'TV': { name: "Secret TV", root: { text: "...", opts: [{t: "Leave", n: "close"}] } }
    };

    // --- INTERACTION LOGIC (The part you couldn't find) ---
    function startDiag(id) {
        const npc = dialogues[id];
        document.getElementById('npc-name').innerText = npc.name; // THIS FIXES THE TV NAME
        document.getElementById('npc-text').innerText = npc.root.text;
        const opts = document.getElementById('npc-options');
        opts.innerHTML = "";
        npc.root.opts.forEach(o => {
            const b = document.createElement('button'); b.innerText = o.t;
            b.onclick = () => { if(o.n==='close') { document.getElementById('dialogue-ui').style.display='none'; } else { /* handle nodes */ } };
            opts.appendChild(b);
        });
        document.getElementById('dialogue-ui').style.display = 'block';
    }

    // --- CONTROLS ---
    const keys = {};
    window.onkeydown = e => { 
        keys[e.code] = true; 
        if(e.code === 'KeyE') {
            if(player.position.distanceTo(teller.position) < 4) startDiag('TELLER');
            if(player.position.distanceTo(tv.position) < 4) startDiag('TV');
        }
    };
    window.onkeyup = e => keys[e.code] = false;

    function animate() {
        requestAnimationFrame(animate);
        if(player) {
            if(keys['KeyW']) player.translateZ(0.1);
            if(keys['KeyA']) player.rotation.y += 0.05;
            if(keys['KeyD']) player.rotation.y -= 0.05;
            camera.position.set(player.position.x, 5, player.position.z - 10);
            camera.lookAt(player.position);
        }
        renderer.render(scene, camera);
    }
    animate();
</script>
</body>
</html>
